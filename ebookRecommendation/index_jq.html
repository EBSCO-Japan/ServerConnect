<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Jay Chang">
    <title>EBSCO ebooks DDA Plus</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/dist/css/bootstrap.css" rel="stylesheet">
    <link href="assets/dist/css/index.css" rel="stylesheet">

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>
    <!-- Custom styles for this template -->
    <link href="form-validation.css" rel="stylesheet">
  </head>
  <body class="bg-light">
    <div class="container">
      <div class="py-5 text-center">
        <img class="logo" src="assets/brand/eBooks_Logo.png" alt="">
      </div>
      <section id="formField">
        <div class="row">
          <div class="col-md-12 order-md-1">
            <h4 class="mb-3">读者信息</h4>
              <div class="mb-3">
                <label for="userName">
                  姓名
                  <span class="text-muted">
                    <img class="icon-star" src="assets/brand/icon/star.svg">
                  </span>
                </label>
                <input type="text" class="form-control" id="userName">
              </div>
              <div class="mb-3">
                <label for="userNumber">
                  学号/工号
                  <span class="text-muted">
                    <img class="icon-star" src="assets/brand/icon/star.svg">
                  </span>
                </label>
                <input type="text" class="form-control" id="userNumber">
              </div>
              <div class="row">
                <div class="col-md-12 mb-3">
                  <label>身份信息</label>
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="userCapacity" id="radio1" value="staff" checked>
                        <label class="form-check-label" for="radio1">教职工</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="userCapacity" id="radio2" value="doctoral">
                        <label class="form-check-label" for="radio2">博士生</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="userCapacity" id="radio3" value="postgraduate">
                        <label class="form-check-label" for="radio3">研究生</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="userCapacity" id="radio4" value="undergraduate">
                        <label class="form-check-label" for="radio4">本科生</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label for="email">
                  Email
                  <span class="text-muted">
                    <img class="icon-star" src="assets/brand/icon/star.svg">
                  </span>
                </label>
                <input type="email" class="form-control" id="email">
              </div>
      
              <div class="mb-3">
                <label for="faculty">单位/学院</label>
                <input type="text" class="form-control" id="faculty">
              </div>
      
              <div class="mb-3">
                <label for="phoneNum">电话号码</label>
                <input type="text" class="form-control" id="phoneNum">
              </div>
              <hr class="mb-3">
              <h4 class="mt-3">申请购买电子书信息</h4>
              <div class="mt-3">
                <label for="isbn">
                  ISBN
                  <span class="text-muted">
                    <img class="icon-star" src="assets/brand/icon/star.svg">
                  </span>
                </label>
                <input type="text" id="isbn" class="form-control">
              </div>
              <div class="mt-3">
                <label for="bookTitle">书名</label>
                <input type="text" id="bookTitle" class="form-control">
              </div>
              <div class="mt-3">
                <label for="publisher">出版社</label>
                <input type="text" id="publisher" class="form-control">
              </div>
              <div class="mt-3">
                <label for="publishDate">出版日期</label>
                <input type="date" id="publishDate" class="form-control">
              </div>
              <hr class="mb-3">
              <h4 class="mt-3">备注信息</h4>
              <div class="mb-3">
                <div class="form-group">
                  <textarea class="form-control" rows="5" id="note"></textarea>
                </div>
              </div>
              <hr class="mb-4">
              <button class="btn btn-primary btn-lg btn-block" onclick="submitForm()">提交</button>
          </div>
        </div>
      </section>
      <!-- <div class="pt-5 text-center">
        <h5>关于版权限制的警告</h5>
        <p class="text-small">
          美国的版权法（美国法典第17篇）管理着作权材料的复印件或其他复制品的制作。在法律规定的某些条件下，图书馆和档案馆有权提供复印件或其他复制品。其中一个特定的条件是复印或复制不是以“私人学习，奖学金或研究以外的任何目的”。如果用户为了超出“合理使用”的目的而提出要求，或稍后使用影印或复制，则该用户可能会对版权侵权承担责任。 如果判定该命令的履行会涉及违反版权法，则该机构保留拒绝复制的权利。
        </p>
      </div> -->
      <footer class="my-5 text-muted text-center text-small">
        <p class="mb-1">&copy; 2020 EBSCO Information Services, Inc.</p>
      </footer>
    </div>

    <div id="dialogue" class="mask" v-if="show" :class="{ show: show }">
      <div class="dialogue-message-frame" v-if="type === 'notFillAll'">
        <div class="dialogue-head">
          <h4>错误</h4>
        </div>
        <div class="dialogue-body">
          请确实将星号处的信息完整
          <div class="btn-frame">
            <button @click="close('dialogue')">关闭</button>
          </div>
        </div>
      </div>
      <div class="dialogue-message-frame">
        <div class="dialogue-head">
          <h4>请求成功</h4>
        </div>
        <div class="dialogue-body">
          您的信息已经收到了
          <div class="btn-frame">
            <button @click="close('window')">关闭</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="assets/js/vendor/jquery.slim.min.js"><\/script>')</script>
    <script src="assets/dist/js/bootstrap.bundle.js"></script>
    <script src="form-validation.js"></script>
  </body>
</html>
<script>
  var an = '';
  var dbCode = '';
  var clientId = '';
  var dom_userName = document.getElementById('userName');
  var dom_userNumber = document.getElementById('userNumber');
  var dom_email = document.getElementById('email');
  var dom_faculty = document.getElementById('faculty');
  var dom_phoneNum = document.getElementById('phoneNum');
  var dom_isbn = document.getElementById('isbn');
  var dom_bookTitle = document.getElementById('bookTitle');
  var dom_publisher = document.getElementById('publisher');
  var dom_publishDate = document.getElementById('publishDate');
  var dom_note = document.getElementById('note');

  // init
  document.addEventListener("DOMContentLoaded", function(event) { 
    const paramTable = ['client','lng','title','aulast','publisher','date','isbn','sid','an','dbCode']
    let url_string = window.location.href;
    let url = new URL(url_string);

    for(index in paramTable) {
      let paramVal = url.searchParams.get(paramTable[index]);

      if(paramVal !== null) {
        switch(paramTable[index]) {
          case 'client':
            clientId = paramVal;
            break;
          case 'title':
            dom_bookTitle.value = paramVal;
            break;
          case 'publisher':
            dom_publisher.value = paramVal;
            break;
          case 'date':
            let dateOutput = [paramVal.slice(0, 4), '-', paramVal.slice(4, 6), '-', paramVal.slice(6)].join('');
            dom_publishDate.value = dateOutput;
            break;
          case 'isbn':
            dom_isbn.value = paramVal;
            break;
          case 'an':
            an = paramVal;
            break;
          case 'dbCode':
            dbCode = paramVal;
            break;
        }
      }
    }
  });

  function submitForm() {
    // console.log(getRadioValueByName('userCapacity'));
    // check value
    if(dom_userName.value.trim() === '' || dom_userNumber.value.trim() === '' || dom_email.value.trim() === '' || dom_isbn.value.trim() === '') {
      alert("请确实将星号处的信息完整");
    } else {
      var capacity = getRadioValueByName('userCapacity');
      formData = {
        userInfo: {
          name: dom_userName.value,
          userNumber: dom_userNumber.value,
          userIdentity: capacity,
          email: dom_email.value,
          faculty: dom_faculty.value,
          phone: dom_phoneNum.value
        },
        purchaseInfo: {
          isbn: dom_isbn.value,
          title: dom_bookTitle.value,
          publisher: dom_publisher.value,
          date: dom_publishDate.value,
        },
        note: dom_note.value,
        an: an,
        dbCode: dbCode
      };
      // send to backend
      $.ajax({
        url: 'https://gss.ebscohost.com/chchang/ServerConnect/ebookRecommendation/features/processEbookRequirement.php',
        type: 'POST',
        data: {
          type: 'add',
          formData: JSON.stringify(formData)
        },
        error: function(jqXHR, exception) {
          //use url variable here
          console.log(jqXHR);
          console.log(exception);
        },
        success: function(res) {
          alert('您的信息已经收到了');
          window.close();
        }
      });
    }
  }

  function getRadioValueByName(name) {
    var radioResult = '';
    var element = document.getElementsByName(name); 

    for(index = 0; index < element.length; index++) {
      if(element[index].checked) {
        radioResult = element[index].value;
      }
    }

    return radioResult;
  }
</script>
